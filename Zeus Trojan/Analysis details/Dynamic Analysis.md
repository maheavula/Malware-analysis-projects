## Detection
you can see in the picture virustotal verdicts that it as malicious with 65/72 antivirus machines.

![virustotal verdict](https://github.com/maheavula/Malware-analysis/assets/116332629/6984d46a-d71b-4936-a663-3eeb27d63f99)

---

## Network Activity

- **Domains**:
  - j.maxmind.com
  - srv11028.dus4.fastwebserver.de - 23.212.219.216
- **HTTP requests**:
  - http://fpdownload.macromedia.com/get/flashplayer/update/current/install/install_all_win_cab_ax_sgn.z
- **Connections**:
  
| PID  | Process                                  | IP                  | Domain                   | ASN       | CN | Reputation |
|------|------------------------------------------|---------------------|--------------------------|-----------|----|------------|
| 4    | System                                   | 192.168.100.255:138 | —                        | —         | —  | whitelisted|
| 4    | System                                   | 192.168.100.255:137 | —                        | —         | —  | whitelisted|
| 1088 | svchost.exe                              | 224.0.0.252:5355    | —                        | —         | —  | unknown    |
| 3972 | invoice_2318362983713_823931342io.pdf.exe| 85.114.128.127:53   | —                        | —         | —  | unknown    |
| 1036 | InstallFlashPlayer.exe                   | 85.114.128.127:53   | —                        | —         | —  | unknown    |
| 1036 | InstallFlashPlayer.exe                   | 23.212.219.216:80   | fpdownload.macromedia.com| AKAMAI-AS | AU | unknown    |
| 472  | services.exe                             | 207.191.243.130:16471| —                       | —         | —  | unknown    |
| 472  | services.exe                             | 71.11.140.115:16471 | —                        | —         | —  | unknown    |
| 472  | services.exe                             | 114.39.95.144:16471 | —                        | —         | —  | unknown    |
| 472  | services.exe                             | 176.61.195.55:16471 | —                        | —         | —  | unknown    |

---

## Files Created/Modified/Deleted

- **Created**:
  - C:\Windows\assembly\GAC\Desktop.ini
  - C:\Users\admin\AppData\Local\Google\Desktop\Install\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\❤≸⋙\Ⱒ☠⍨\‮ﯹ๛\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\GoogleUpdate.exe
  - C:\Users\admin\AppData\Local\Temp\msimg32.dll
- **Opened**
    - C:\Users\<USER>\AppData\Local\Google
    - C:\Users\<USER>\AppData\Local\Google\Desktop
    - C:\Users\<USER>\AppData\Local\Google\Desktop\Install
    - C:\Users\<USER>\AppData\Local\Google\Desktop\Install\{3575d11f-4b37-f3bb-b275-ac8959652946}
    - C:\Users\<USER>\AppData\Local\Google\Desktop\Install\{3575d11f-4b37-f3bb-b275-ac8959652946}\\x2764\x2278\x22d9
    - C:\Users\<USER>\AppData\Local\Google\Desktop\Install\{3575d11f-4b37-f3bb-b275-ac8959652946}\\x2764\x2278\x22d9\\x2c22\x2620\x2368
    - C:\Users\<USER>\AppData\Local\Google\Desktop\Install\{3575d11f-4b37-f3bb-b275-ac8959652946}\\x2764\x2278\x22d9\\x2c22\x2620\x2368\\x202e\xfbf9\xe5b
    - C:\Users\<USER>\AppData\Local\Google\Desktop\Install\{3575d11f-4b37-f3bb-b275-ac8959652946}\\x2764\x2278\x22d9\\x2c22\x2620\x2368\\x202e\xfbf9\xe5b\{3575d11f-4b37-f3bb-b275-ac8959652946}
    - C:\Users\<USER>\AppData\Local\Google\Desktop\Install\{3575d11f-4b37-f3bb-b275-ac8959652946}\\x2764\x2278\x22d9\\x2c22\x2620\x2368\\x202e\xfbf9\xe5b\{3575d11f-4b37-f3bb-b275-ac8959652946}\GoogleUpdate.exe
    - C:\Users\<USER>\AppData\Local\Temp\CRYPTSP.dll
- **Deleted**
    - C:\Users\<USER>\AppData\Local\Temp\executable.exe
    - <PATH_SAMPLE.EXE>
    - %SAMPLEPATH%\69e966e730557fde8fd84317cdef1ece00a8bb3470c0b58f3231e170168af169.exe
    - %SAMPLEPATH%\file.exe
    - %USERPROFILE%\AppData\Local\Microsoft\Windows\INetCache\IE\KLT1I0ZU\update50[1].xml
    - C:\ProgramData\Microsoft\Windows\WER\Temp\WER1911.tmp.WERInternalMetadata.xml
    - C:\ProgramData\Microsoft\Windows\WER\Temp\WER1922.tmp.csv
    - C:\ProgramData\Microsoft\Windows\WER\Temp\WER1933.tmp.txt
    - C:\ProgramData\Microsoft\Windows\WER\Temp\WER1B72.tmp.WERInternalMetadata.xml
    - C:\ProgramData\Microsoft\Windows\WER\Temp\WER1BB1.tmp.WERInternalMetadata.xml

- **Dropped**

    | PID  | Process                                   | Filename                                                                                                                                                                        | Type        | MD5                                | SHA256                                                            |
    |------|-------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-----------------------------------|-------------------------------------------------------------------|
    | 3972 | invoice_2318362983713_823931342io.pdf.exe | C:\Users\admin\AppData\Local\Google\Desktop\Install\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\❤≸⋙\Ⱒ☠⍨\‮ﯹ๛\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\@ | binary      | DBE1E720820BA425A43E796C94CB947B | B6B77336967C6485A0E8FC6CCF8324C214E79E78A836A38F216FE3A0924B6DEF   |
    | 1036 | InstallFlashPlayer.exe                    | C:\Program Files\Google\Desktop\Install\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\ \...\‮ﯹ๛\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\GoogleUpdate.exe                                 | executable  | EA039A854D20D7734C5ADD48F1A51C34 | 69E966E730557FDE8FD84317CDEF1ECE00A8BB3470C0B58F3231E170168AF169   |
    | 1036 | InstallFlashPlayer.exe                    | C:\Program Files\Google\Desktop\Install\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\ \...\‮ﯹ๛\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\@                                                  | binary      | 606E24F0122FF4E6A776D294771B7113 | E92A1EDBDEB1C9D6D0395EF841CA05EA5F7B618E3C01E11E44411219212DED6B   |
    | 3972 | invoice_2318362983713_823931342io.pdf.exe | C:\Users\admin\AppData\Local\Google\Desktop\Install\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\❤≸⋙\Ⱒ☠⍨\‮ﯹ๛\{6c5bc945-ecdc-d004-f972-a3d5e5911bb1}\GoogleUpdate.exe                | executable  | EA039A854D20D7734C5ADD48F1A51C34 | 69E966E730557FDE8FD84317CDEF1ECE00A8BB3470C0B58F3231E170168AF169   |
    | 472  | services.exe                              | C:\Windows\assembly\GAC\Desktop.ini                                                                                                                                              | executable  | D1A909DB8D6F6A6DA32050F077BE630C | 315387A3E83AAE9A667B82635B26A4D8576887887732239422D63E0F964CA17B   |
    | 3972 | invoice_2318362983713_823931342io.pdf.exe | C:\Users\admin\AppData\Local\Temp\msimg32.dll                                                                                                                                     | executable  | E051308C2F0C1B280514C99AABD36E34 | DDF7CCAB32E8C0EE6294DF2591EFAC632C27C61D073B86B97DE62311F9379212   |
    | 3972 | invoice_2318362983713_823931342io.pdf.exe | C:\Users\admin\AppData\Local\Temp\InstallFlashPlayer.exe                                                                                                                          | executable  | 2FF9B590342C62748885D459D082295F | 672EC8DCEAFD429C1A09CFAFBC4951968953E2081E0D97243040DB16EDB24429   |
      
---

## Registry Keys

- **Opened**:
    - HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Local AppData
    - HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\Google Update\x00\x202e\x2764
    - HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders
    - HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
    - HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\GRE_Initialize\DisableMetaFiles
    - HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\GRE_Initialize\DisableUmpdBufferSizeCheck
    - HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\GRE_Initialize
    - <HKCU>\Software\Microsoft\RAS AutoDial
    - <HKCU>\Software\Microsoft\RAS AutoDial\Default
    - <HKCU>\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders

- **Keys Set**:
    - HKLM\SYSTEM\ControlSet001\Services\.etadpug\Description
    - HKLM\SYSTEM\ControlSet001\Services\.etadpug\DisplayName
    - HKLM\SYSTEM\ControlSet001\Services\.etadpug\ErrorControl
    - HKLM\SYSTEM\ControlSet001\Services\.etadpug\ImagePath
    - HKLM\SYSTEM\ControlSet001\Services\.etadpug\ObjectName
    - HKLM\SYSTEM\ControlSet001\Services\.etadpug\Parameters\Parameters
    - HKLM\SYSTEM\ControlSet001\Services\.etadpug\Start
    - HKLM\SYSTEM\ControlSet001\Services\.etadpug\Type
    - HKLM\SYSTEM\ControlSet001\Services\WinSock2\Parameters\NameSpace_Catalog5\Catalog_Entries64\000000000001\LibraryPath
    - HKLM\SYSTEM\ControlSet001\Services\WinSock2\Parameters\NameSpace_Catalog5\Catalog_Entries64\000000000005\LibraryPath
- **Deleted**:
  
    - <HKLM>\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\Windows Defender
    - <HKLM>\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\explorer\ShellServiceObjects\{F56F6FDD-AA9D-4618-A949-C1B91AF43B1A}
    - <HKLM>\SYSTEM\CURRENTCONTROLSET\SERVICES\PolicyAgent\Enum\0
    - <HKLM>\SYSTEM\CURRENTCONTROLSET\SERVICES\SharedAccess\Enum\0
    - <HKLM>\SYSTEM\CURRENTCONTROLSET\SERVICES\wscsvc\Enum\0
    - <HKLM>\SYSTEM\CurrentControlSet\Services\WinDefend
    - <HKLM>\SYSTEM\CurrentControlSet\Services\WinDefend\Parameters
    - <HKLM>\SYSTEM\CurrentControlSet\Services\WinDefend\Security
    - <HKLM>\SYSTEM\CurrentControlSet\Services\WinDefend\TriggerInfo
    - <HKLM>\SYSTEM\CurrentControlSet\Services\WinDefend\TriggerInfo\0

---

This is how the malware file was started with execute the initial exe file and instantly dropping other malicious file.

![attack graph](https://github.com/maheavula/Malware-analysis/assets/116332629/d9503180-0705-407c-b841-518403cec522)

The task involved the execution of several processes, starting with services.exe and explorer.exe, followed by the execution of suspicious files named **invoice_2318362983713_823931342io.pdf.exe and InstallFlashPlayer.exe**. The process tree shows a chain of execution that leads to the command prompt (cmd.exe) and Windows Media Player configuration (wmpnscfg.exe). The modified files section indicates changes to various executables and binaries in the system, including the presence of files in unusual directories like C:\\Users\\admin\\AppData\\Local\\Google\\Desktop\\Install and C:\\Program Files\\Google\\Desktop\\Install. Additionally, registry modifications were made, affecting WinSock2 parameters, Action Center settings, and Internet Settings, among others. Lastly, an HTTP request with a 404 error was made to a suspicious URL related to Flash Player update.

The most interesting events in this task include the execution of files from temporary directories, which is a common tactic used by malware to evade detection. The modification of registry keys related to **network settings, Action Center configurations, and Internet Settings is concerning**, as these changes could indicate attempts to maintain persistence or control over the system. The HTTP request with a 404 error to a URL containing **"flashplayer"** in the path raises red flags, suggesting a potential attempt to download malicious content or exploit vulnerabilities related to Flash Player.

---
## Conclusion

The comprehensive analysis of the Zeus Trojan malware variant has revealed significant insights into its structure, behavior, and potential impact. Through static, dynamic, and behavioral analysis, several key observations were made:

- **Static Analysis**:
  The malware exhibits sophisticated packing techniques, with high entropy indicating potential obfuscation.
  Various hash values, file properties, and imported functions were identified, providing crucial indicators for detection and analysis.

- **Dynamic Analysis**:
  The malware interacts with numerous IP addresses and domains, demonstrating its capability to exfiltrate data and communicate with command-and-control (C2) servers.
  It creates and modifies several files and registry keys to ensure persistence and execute its malicious payload.

  Zeus Trojan employs techniques to evade detection and analysis, such as injecting code into legitimate processes and manipulating system files.
  It displays network activity that includes HTTP and DNS requests to known malicious domains, highlighting its focus on data theft and external communication.
  The Zeus Trojan is designed to capture sensitive banking credentials through keylogging, allowing attackers to steal login information as users enter them on banking websites.


---

## Mitigation Strategies

To combat the Zeus Trojan and similar threats, the following measures are recommended:

- **Network Monitoring**: Implement robust network monitoring to detect unusual traffic patterns and communications with known malicious IPs and domains.

- **Endpoint Protection**: Utilize advanced endpoint protection solutions capable of detecting and responding to malicious file activity and registry changes.

- **Regular Updates**: Ensure that all systems and software are regularly updated to patch vulnerabilities that malware can exploit.

- **User Education**: Educate users on safe computing practices, including recognizing phishing attempts and avoiding suspicious downloads.

---
## YARA Rules

```yara
rule ZeusTrojan {
    meta:
        description = "YARA rule for detecting Zeus Trojan malware"
        author = "Mahesh.A"
        date = "2024-06-21"
    strings:
        $string1 = "invoice_2318362983713_823931342io.pdf.exe"
        $string2 = "j.maxmind.com"
        $string3 = "srv11028.dus4.fastwebserver.de"
        $string4 = "http://fpdownload.macromedia.com/get/flashplayer/update/current/install/install_all_win_cab_ax_sgn.z"
    condition:
        any of ($string*)
}

